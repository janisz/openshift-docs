[id="monitor-acs"]
= Monitoring {product-title-short}
include::modules/common-attributes.adoc[]
:context: monitor-acs

toc::[]

[role="_abstract"]
link:https://docs.openshift.com/container-platform/4.13/monitoring/monitoring-overview.html[{ocp}] includes a preconfigured,
preinstalled, and self-updating monitoring stack that provides monitoring for core platform components.
{product-title-short} exposes metrics to {osp} monitoring via an encrypted and authenticated endpoint.


== Monitoring with {osp}

[IMPORTANT]
====
If you have previously configured monitoring with the Prometheus Operator,
consider removing your custom ServiceMonitor resources. {product-title-short} ships with a pre-configured ServiceMonitor for {osp} monitoring.
Multiple ServiceMonitors may result in duplicated scraping.
====

[NOTE]
====
Monitoring with {osp} is not supported by Scanner.
If you want to monitor Scanner see the xref:#monitor-with-custom-prometheus[Monitoring with custom Prometheus] for more information.
====

Monitoring with {osp} is enabled by default to disable do following steps:

[discrete]
=== Disable Monitoring Central services with {osp} monitoring by using the {product-title-short} Operator


[role="_abstract"]
You can configure monitoring for Central services by changing the configuration of the `Central` custom resource.

.Procedure
. On the {ocp} web console, go to the *Operators* → *Installed Operators* page.
. Select the {product-title-short} Operator from the list of installed Operators.
. Click on the *Central* tab.
. From the list of Central instances, click on a Central instance for which you want to enable monitoring.
. Click on the *YAML* tab and update the YAML configuration
[source,yaml]
----
monitoring:
    openshift:
        enabled: false
----

[role="_additional-resources"]
.Additional resources
* xref:../installing/installing_ocp/install-central-config-options-ocp.adoc#install-central-config-options-ocp[Central configuration options using the Operator]

[discrete]
=== Disable Monitoring Central services with {osp} monitoring by using Helm charts

[role="_abstract"]
You can configure monitoring for Central services by changing the configuration options in the `central-services` Helm chart.

.Procedure
. Update the configuration file with the following value
[source,yaml]
----
monitoring.openshift.enabled: false
----
. Run the `helm upgrade` command and specify the configuration files

[role="_additional-resources"]
.Additional resources
* xref:../installing/installing_other/install-central-other.adoc#change-config-options-after-deployment-central-services_install-central-other[Changing configuration options after deploying the central-services Helm chart]
* link:https://helm.sh/docs/helm/helm_install/#synopsis[Helm documentation]

== Monitoring with custom Prometheus
[id="monitor-with-custom-prometheus"]


[role="_abstract"]
link:https://prometheus.io/[Prometheus] is an open-source monitoring and alerting platform.
You can use it to monitor health and availability of Central and Sensor components of {rh-rhacs-first}. When you enable monitoring, {product-title-short} creates a new monitoring service on port number 9090 and a network policy allowing inbound connections to that port.

[NOTE]
====
This monitoring service exposes an endpoint that is not encrypted by TLS and has no authorization.
Use this only when you do not want to use {osp} monitoring.
====

[discrete]
=== Monitoring Central services using the {product-title-short} Operator

[role="_abstract"]
You can monitor Central services, Central and Scanner, by changing the configuration of the `Central` custom resource.

.Procedure
. On the {ocp} web console, go to the *Operators* → *Installed Operators* page.
. Select the {product-title} Operator from the list of installed Operators.
. Click on the *Central* tab.
. From the list of Central instances, click on a Central instance for which you want to enable monitoring for.
. Click on the *YAML* tab and update the YAML configuration:
* For monitoring Central, enable the `central.monitoring.exposeEndpoint` configuration option for the `Central` custom resource.
* For monitoring Scanner, enable the `scanner.monitoring.exposeEndpoint` configuration option for the `Central` custom resource.
. Click *Save*.

[role="_additional-resources"]
.Additional resources
* xref:../installing/installing_ocp/install-central-config-options-ocp.adoc#install-central-config-options-ocp[Central configuration options using the Operator]

[discrete]
=== Monitoring Central services using Helm charts

[role="_abstract"]
You can monitor Central services, Central and Scanner, by changing the configuration options in the `central-services` Helm chart.

.Procedure
. Update the `values-public.yaml` configuration file with the following values:
+
[source,yaml]
----
central.exposeMonitoring: true
scanner.exposeMonitoring: true
----
. Run the `helm upgrade` command and specify the configuration files

[role="_additional-resources"]
.Additional resources
* xref:../installing/installing_other/install-central-other.adoc#change-config-options-after-deployment-central-services_install-central-other[Changing configuration options after deploying the central-services Helm chart]
* link:https://helm.sh/docs/helm/helm_install/#synopsis[Helm documentation]